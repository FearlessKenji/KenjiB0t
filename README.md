# Twitch Discord Bot
This Discord bot will automatically send a message and tag the assigned role whenever a streamer went live.
It also has functionality for posting new Reddit posts from subreddits of your choosing.
The notifications will update every minute(default) while the streamer is live.

## How does it work?
This Discord bot uses [The Official Twitch Api](https://dev.twitch.tv/docs/api/). You are able to assign unlimited streamers to the bot. The bot uses the api to fetch the channel data to see if the streamer is live. If the streamer is live it will send a message in the assigned channel and it will also tag the assigned role. You will be able to choose the update time. If the streamer is still live the bot will update the message after X amount of time. 


# Installation
First you will have to clone the project.
```console
$ git clone https://github.com/FearlessKenji/KenjiB0t
```

## Dependencies
In order for the bot to work properly you will have to install the required node packages outlined in packages.json. Use the following command to install the dependencies.
```console
$ npm install
```

## Edit blank_config.json
- Rename to config.json
- token - Enter your [Discord bot token](https://discord.com/developers/applications) here.
- twitchClientId - Enter the Twitch application client ID here: ([Twitch Developer Console](https://dev.twitch.tv/console/apps)).
- twitchSecret - Generate a api token on the Twitch application page.
- botOwner - Copy and paste your discord ID for top access commands.
- clientId - Copy and paste your application ID. You need this to register commands.
- guildID - Copy and paste your Discord server ID here. This is for private guild-access commands.
- redditCron - Checks reddit for specified subreddits every minute by default. 
- twitchCron - Checks Twitch for specified live channels every minute by default.
- statusCron - Changes bot status every 10 minutes by default.
- authCron - Changes Twitch auth token every hour by default. This is required. Only adjust if you are getting 403 Authorization errors.
- authToken - Autogenerated auth key for getting twitch usernames. Leave alone.

All of these fields except 'authToken' are required.

Check [Cron Guru](https://crontab.guru/) for help setting up crons. Crons will always fire at a specific clock time regardless of startup time.

## Register Slash Commands
Before you can use the commands, you need to run 
```console
$ node deploy-global-commands.js
```
and/or
```console
$ node deploy-guild-commands.js
```

The global commands will be available in all servers. The guild commands will only be available in the server whos ID is matched with 'guildId' in the config.


## Run the bot
After you updated the config.json, installed the dependencies, and registered the commands, you can run the final command.
Use the command in the same directory as the index.js file.
```console
$ node index.js
```
or
```console
$ npm run start
```

## Add streamers
Use the 'twitch' slash command to add users to the database. Usage:
```console
/twitch add name: FearlessKenji discord: https://discord.gg/FearlessKenji
```
- name - Enter the streamer login name here. This name is the same as the name in the channel URL.  
Example:
  - URL = https://www.twitch.tv/fearlesskenji
  - name = fearlesskenji
- discord - This field is not required but if the Streamer has their own Discord server you could add the invite url here. 

## Add subreddits
Use the 'reddit' slash command to add subs to the database. Usage:
```console
/reddit add name: aww channel: #reddit
```
- name - Enter the subreddit name here. Do not add r/.
- channel - This field IS REQUIRED. This is the channel that the sub updates get posted to. You can specify different channels for different subs.

There should be feedback on whether or not the addition was successful.
There is a list command to check for spelling if updates are not coming through.
There is also a delete command for that deletes entries from the database. 

Congratulations! You have successfully setup the bot.